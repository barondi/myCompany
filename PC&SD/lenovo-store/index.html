<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="description" content="Lenovo,联想直营店,联想服务店" />
    <meta name="keywords" content="Lenovo,联想直营店,联想服务店" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>附近的联想店铺</title>
    <link rel="stylesheet" href="./css/public.css">
    <link rel="stylesheet" href="./css/style.css">
    <style>
        .info{font-size:14px;width:88%;box-shadow:0 0 6px 2px #dadada;padding:3% 3% 0;position:absolute;bottom:15px;left:3%;background-color:#ffffff;}
        .top{margin-bottom:10px;}
        .top .title{float:left;}
        .top .title img{width:25px;height:25px;vertical-align:middle;}
        .top .title span{font-size:16px;vertical-align:middle;}
        .top .dis{float:right;line-height:25px;color:#665f66;}
        .middle{padding-bottom:14px;border-bottom:1px solid #dadada;}
        .middle p{color:#665f66;line-height:20px;}
        .bottom{display:-webkit-box;display:-moz-box;display:-ms-flexbox;display:-webkit-flex;display:flex;-webkit-box-align:center;-moz-box-align: center;-ms-flex-align: center;-webkit-align-items: center;align-items: center;text-align: center;position:relative;}
        .bottom .road,.bottom .tel{padding:10px 0;-webkit-box-flex:1;-moz-box-flex:1;-webkit-flex:1;-ms-flex:1;flex:1;}
        .bottom .road em{width:27px;height:23px;background:url("./img/road.png") no-repeat center center;background-size:100% 100%;display:inline-block;vertical-align:middle;}
        .bottom .tel em{width:27px;height:23px;background:url("./img/tel.png") no-repeat center center;background-size:100% 100%;display:inline-block;vertical-align:middle;}
        .bottom .road span,.bottom .tel span{margin:0;font-size:16px;color:#000000;vertical-align:middle;}
        .bottom .line{height:28px;border-right:1px solid #dadada;position:absolute;left:50%;top:8px;}
        .bottom .tel{position:relative;}
        .bottom .tel input{position:absolute;left:0;top:0;width:100%;height:100%;z-index:99;opacity:0;}
    </style>
</head>
<body>
<div id="container">

</div>
<div class="info">
    <div class="top clearfix">
        <div class="title">
            <img src="./img/zhiyingdian.png" />
            <span>联想官方直营店-五彩城店</span>
        </div>
        <span class="dis">3.94公里</span>
    </div>
    <div class="middle">
        <p>北京市海淀区清河中街五彩城购物中心西区L108</p>
        <p>周一至周日10:00-19:00</p>
    </div>
    <div class="bottom">
        <div class="road">
            <em></em>
            <span>路线</span>
        </div>
        <div class="line"></div>
        <div class="tel">
            <a href="tel:18910862912">
                <em></em>
                <span>咨询</span>
            </a>
        </div>
    </div>
</div>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.3&key=66562510ed4d997bcf8a204d93b01fbc"></script>
<script type="text/javascript" src="./js/jquery-1.11.3.min.js"></script>
<script type="text/javascript">
    $(function(){
        //展示地图
        var map = new AMap.Map('container', {
            resizeEnable: true,
            zoom:11
            //center: [116.397428, 39.90923]
        });

        //打点
        var icon = new AMap.Icon({
            image: 'http://vdata.amap.com/icons/b18/1/2.png',//24px*24px
            //icon可缺省，缺省时为默认的蓝色水滴图标，
            size: new AMap.Size(24, 24)
        });
        var data={
            a:{
                name:'联想直营店1',
                lng:'116.39974',
                lat:'40.153676',
                type:1
            },
            b:{
                name:'联想直营店2',
                lng:'116.19974',
                lat:'40.053676',
                type:1
            },
            c:{
                name:'联想普通店1',
                lng:'116.30974',
                lat:'40.103676',
                type:2
            }
        }
        for(var key in data){
            var pos = [data[key].lng,data[key].lat];
            //map.clearMap();
            var marker = new AMap.Marker({
                icon:icon,
                position: pos,
                map: map
            });
            showInfW(marker);
        }

        var geolocation;
        map.plugin('AMap.Geolocation', function() {
            geolocation = new AMap.Geolocation({
                enableHighAccuracy: true,//是否使用高精度定位，默认:true
                timeout: 10000,          //超过10秒后停止定位，默认：无穷大
                buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
                //zoomToAccuracy: true,      //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
                buttonPosition:'RT'
            });
            map.addControl(geolocation);
            geolocation.getCurrentPosition();
            AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
            AMap.event.addListener(geolocation, 'error', onError);      //返回定位出错信息
        });


        function onComplete(data) {
            alert('定位成功：'+data.position.getLng()+'&&'+data.position.getLat());
        };
        function onError(data) {
            alert('定位失败');
        };
        function showInfW(marker){
            //实例化信息窗体
            var title = '方恒假日酒店<span style="font-size:11px;color:#F00;">价格:318</span>',content=[];
            content.push("<img src='https://tpc.googlesyndication.com/simgad/5843493769827749134'>地址：北京市朝阳区阜通东大街6号院3号楼东北8.3公里");
            content.push("电话：010-64733333");
            content.push("<a href='https://ditu.amap.com/detail/B000A8URXB?citycode=110105'>详细信息</a>");
            var infoWindow = new AMap.InfoWindow({
                isCustom: true,  //使用自定义窗体
                content: createInfoWindow(title, content.join("<br/>")),
                offset: new AMap.Pixel(16, -45)
            });
            //鼠标点击marker弹出自定义的信息窗体
            AMap.event.addListener(marker, 'click', function() {
                var curPos = marker.getPosition();
                console.log(curPos)
                var curObj = null;
                alert(curPos.lng)
                for(var key in data){
                    if(curPos.lng == data[key].lng && curPos.lat == data[key].lat){
                        curObj = data[key];
                    }
                }
                alert(curObj.name)
                infoWindow.open(map, marker.getPosition());
            });
        }
        //构建自定义信息窗体
        function createInfoWindow(title, content) {
            var info = document.createElement("div");
            info.className = "info";

            //可以通过下面的方式修改自定义窗体的宽高
            //info.style.width = "400px";
            // 定义顶部标题
            var top = document.createElement("div");
            var titleD = document.createElement("div");
            var closeX = document.createElement("img");
            top.className = "info-top";
            titleD.innerHTML = title;
            closeX.src = "https://webapi.amap.com/images/close2.gif";
            closeX.onclick = closeInfoWindow;

            top.appendChild(titleD);
            top.appendChild(closeX);
            info.appendChild(top);

            // 定义中部内容
            var middle = document.createElement("div");
            middle.className = "info-middle";
            middle.style.backgroundColor = 'white';
            middle.innerHTML = content;
            info.appendChild(middle);

            // 定义底部内容
            var bottom = document.createElement("div");
            bottom.className = "info-bottom";
            bottom.style.position = 'relative';
            bottom.style.top = '0px';
            bottom.style.margin = '0 auto';
            var sharp = document.createElement("img");
            sharp.src = "https://webapi.amap.com/images/sharp.png";
            bottom.appendChild(sharp);
            info.appendChild(bottom);
            return info;
        };
        //关闭信息窗体
        function closeInfoWindow() {
            map.clearInfoWindow();
        }
    })
</script>
</body>
</html>